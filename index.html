<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Subiteren met dobbelstenen</title>
  <style>
    :root{
      --bg:#0b1020;
      --text:rgba(255,255,255,0.92);
      --muted:rgba(255,255,255,0.70);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      background: radial-gradient(1200px 800px at 20% 10%, #1a2653 0%, var(--bg) 55%) fixed;
      color: var(--text);
      overflow:hidden;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }

    .hud{
      position: fixed;
      top: 10px;
      left: 10px;
      right: 10px;
      display:flex;
      justify-content: space-between;
      align-items:center;
      pointer-events:none;
      z-index: 10;
    }
    .pill{
      pointer-events:auto;
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(0,0,0,0.22);
      border: 1px solid rgba(255,255,255,0.10);
      backdrop-filter: blur(8px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
      font-weight: 900;
      letter-spacing: 0.2px;
    }
    .iconBtn{
      pointer-events:auto;
      width: 46px;
      height: 46px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.22);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      box-shadow: 0 10px 30px rgba(0,0,0,0.22);
      backdrop-filter: blur(8px);
    }
    .iconBtn:active{transform: translateY(1px) scale(0.99)}

    .stage{
      position: fixed;
      inset: 0;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 72px 16px 180px;
    }

    .cardWrap{
      width: min(520px, 92vw);
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
    }

    img.diceCard{
      width: min(520px, 92vw);
      max-width: 520px;
      height: auto;
      border-radius: 28px;
      box-shadow: 0 18px 50px rgba(0,0,0,0.40);
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.03);
    }

    .cover{
      position:absolute;
      inset: 0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size: 56px;
      font-weight: 950;
      letter-spacing: 0.6px;
      background: rgba(11,16,32,0.88);
      border-radius: 28px;
      border: 1px solid rgba(255,255,255,0.10);
      opacity: 0;
      pointer-events:none;
      transition: opacity 120ms ease;
    }
    .cover.show{opacity:1}

    .bigPlay{
      position:absolute;
      inset: 0;
      display:flex;
      align-items:center;
      justify-content:center;
      border: none;
      background: transparent;
      cursor:pointer;
    }
    .bigPlay svg{
      width: 110px;
      height: 110px;
      filter: drop-shadow(0 14px 30px rgba(0,0,0,0.35));
    }
    .bigPlay:active{transform: translateY(1px) scale(0.99)}

    .pad{
      position: fixed;
      left: 16px;
      right: 16px;
      bottom: 16px;
      display:grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      max-width: 920px;
      margin: 0 auto;
    }
    @media (max-width: 560px){
      .pad{grid-template-columns: repeat(4, 1fr)}
    }
    .numBtn{
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.08);
      color: var(--text);
      border-radius: 18px;
      padding: 18px 0;
      font-size: 28px;
      font-weight: 950;
      cursor:pointer;
      box-shadow: 0 10px 26px rgba(0,0,0,0.24);
    }
    .numBtn:active{transform: translateY(1px) scale(0.99)}
    .numBtn.good{outline: 3px solid rgba(46,229,157,0.55)}
    .numBtn.bad{outline: 3px solid rgba(255,92,122,0.55)}
    .numBtn:disabled{opacity:0.75; cursor: default}

    .overlay{
      position: fixed;
      inset: 0;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(0,0,0,0.25);
      opacity:0;
      pointer-events:none;
      transition: opacity 140ms ease;
      z-index: 9;
    }
    .overlay.show{opacity:1; pointer-events:auto}
    .resultCard{
      width: min(520px, 92vw);
      border-radius: 28px;
      background: rgba(0,0,0,0.30);
      border: 1px solid rgba(255,255,255,0.12);
      backdrop-filter: blur(10px);
      box-shadow: 0 22px 60px rgba(0,0,0,0.42);
      padding: 18px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 14px;
    }
    .face{
      width: 64px;
      height: 64px;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size: 36px;
    }
    .bigN{
      font-size: 54px;
      font-weight: 950;
      letter-spacing: 0.4px;
    }
    .nextBtn{
      width: 72px;
      height: 72px;
      border-radius: 24px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.08);
      color: var(--text);
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .nextBtn:active{transform: translateY(1px) scale(0.99)}
    .nextBtn svg{width: 34px; height: 34px}

    .settingsMask{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 16px;
      z-index: 20;
    }
    .settingsMask.show{display:flex}
    .settings{
      width: min(560px, 94vw);
      border-radius: 26px;
      background: rgba(0,0,0,0.40);
      border: 1px solid rgba(255,255,255,0.12);
      backdrop-filter: blur(10px);
      box-shadow: 0 22px 60px rgba(0,0,0,0.42);
      padding: 16px;
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    @media (max-width: 560px){
      .grid{grid-template-columns: 1fr}
    }
    .field{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      padding: 12px 12px;
      border-radius: 18px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.10);
    }
    .field span{color: var(--muted); font-weight: 900}
    input[type="number"]{
      width: 120px;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.20);
      color: var(--text);
      font-weight: 950;
      font-size: 18px;
      outline: none;
      text-align:center;
    }
    .toggles{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    @media (max-width: 560px){
      .toggles{grid-template-columns: 1fr}
    }
    .toggle{
      display:flex;
      align-items:center;
      justify-content: space-between;
      padding: 12px 12px;
      border-radius: 18px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.10);
      cursor:pointer;
      font-weight: 950;
    }
    .toggle input{transform: scale(1.25)}
    .rowBtns{
      display:flex;
      gap: 10px;
      margin-top: 12px;
    }
    .btn{
      flex:1;
      padding: 12px 12px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.08);
      color: var(--text);
      font-weight: 950;
      cursor:pointer;
    }
    .btn.primary{background: rgba(46,229,157,0.16)}
    .btn:active{transform: translateY(1px) scale(0.99)}
    .warn{
      display:none;
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 18px;
      background: rgba(255,92,122,0.12);
      border: 1px solid rgba(255,92,122,0.30);
      font-weight: 950;
      color: rgba(255,255,255,0.92);
    }
  </style>
</head>
<body>

  <div class="hud">
    <div class="pill" id="scorePill">‚≠ê 0</div>
    <button class="iconBtn" id="gearBtn" aria-label="Instellingen">
      <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <circle cx="12" cy="12" r="3.2"></circle>
        <path d="M19.4 15a7.9 7.9 0 0 0 .1-2l2-1.2-2-3.4-2.3.6a7.5 7.5 0 0 0-1.7-1L13 2h-4l-.5 3a7.5 7.5 0 0 0-1.7 1L4.5 5.4 2.5 8.8l2 1.2a7.9 7.9 0 0 0 .1 2l-2 1.2 2 3.4 2.3-.6a7.5 7.5 0 0 0 1.7 1L9 22h4l.5-3a7.5 7.5 0 0 0 1.7-1l2.3.6 2-3.4-2-1.2Z"></path>
      </svg>
    </button>
  </div>

  <div class="stage">
    <div class="cardWrap">
      <img class="diceCard" id="cardImg" alt="" />
      <div class="cover show" id="cover">‚ñ∂</div>

      <button class="bigPlay" id="startBtn" aria-label="Start">
        <svg viewBox="0 0 24 24" fill="white" aria-hidden="true">
          <path d="M8 5v14l12-7z"></path>
        </svg>
      </button>
    </div>
  </div>

  <div class="pad" id="pad" style="display:none"></div>

  <div class="overlay" id="overlay">
    <div class="resultCard">
      <div class="face" id="emoji">üôÇ</div>
      <div class="bigN" id="bigNumber">0</div>
      <button class="nextBtn" id="nextBtn" aria-label="Volgende">
        <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M9 18l6-6-6-6"></path>
        </svg>
      </button>
    </div>
  </div>

  <div class="settingsMask" id="settingsMask" aria-hidden="true">
    <div class="settings" role="dialog" aria-label="Instellingen">
      <div class="grid">
        <div class="field">
          <span>min</span>
          <input id="minTotal" type="number" min="1" max="10" value="1" />
        </div>
        <div class="field">
          <span>max</span>
          <input id="maxTotal" type="number" min="1" max="10" value="10" />
        </div>
        <div class="field">
          <span>flits</span>
          <input id="flashMs" type="number" min="200" max="2500" value="900" />
        </div>
        <div class="field">
          <span>ms</span>
          <div style="width:120px;text-align:center;font-weight:950;color:var(--muted)"> </div>
        </div>
      </div>

      <div class="toggles" aria-label="Stapjes">
        <label class="toggle"><span>gelijk</span><input id="step0" type="checkbox" checked /></label>
        <label class="toggle"><span>1 meer</span><input id="step1" type="checkbox" checked /></label>
        <label class="toggle"><span>2 meer</span><input id="step2" type="checkbox" checked /></label>
      </div>

      <div class="toggles" style="grid-template-columns: 1fr 1fr; margin-top:10px" aria-label="Volgorde">
        <label class="toggle"><span>grootste eerst</span><input id="bigFirst" type="checkbox" checked /></label>
        <label class="toggle"><span>grootste achteraan</span><input id="bigBack" type="checkbox" checked /></label>
      </div>

      <div class="warn" id="warnBox"></div>

      <div class="rowBtns">
        <button class="btn" id="resetBtn">reset</button>
        <button class="btn primary" id="saveBtn">ok</button>
      </div>
    </div>
  </div>

  <script>
    const CARDS = {"1": [{"src": "dice_assets/dobbelsteen01a.png", "left": 1, "right": 0, "diceCount": 1}], "2": [{"src": "dice_assets/dobbelsteen02a.png", "left": 2, "right": 0, "diceCount": 1}, {"src": "dice_assets/dobbelsteen02b.png", "left": 1, "right": 1, "diceCount": 2}], "3": [{"src": "dice_assets/dobbelsteen03a.png", "left": 3, "right": 0, "diceCount": 1}, {"src": "dice_assets/dobbelsteen03b.png", "left": 1, "right": 2, "diceCount": 2}, {"src": "dice_assets/dobbelsteen03c.png", "left": 2, "right": 1, "diceCount": 2}], "4": [{"src": "dice_assets/dobbelsteen04a.png", "left": 4, "right": 0, "diceCount": 1}, {"src": "dice_assets/dobbelsteen04b.png", "left": 1, "right": 3, "diceCount": 2}, {"src": "dice_assets/dobbelsteen04c.png", "left": 2, "right": 2, "diceCount": 2}, {"src": "dice_assets/dobbelsteen04d.png", "left": 3, "right": 1, "diceCount": 2}], "5": [{"src": "dice_assets/dobbelsteen05a.png", "left": 5, "right": 0, "diceCount": 1}, {"src": "dice_assets/dobbelsteen05b.png", "left": 1, "right": 4, "diceCount": 2}, {"src": "dice_assets/dobbelsteen05c.png", "left": 2, "right": 3, "diceCount": 2}, {"src": "dice_assets/dobbelsteen05d.png", "left": 3, "right": 2, "diceCount": 2}, {"src": "dice_assets/dobbelsteen05e.png", "left": 4, "right": 1, "diceCount": 2}], "6": [{"src": "dice_assets/dobbelsteen06a.png", "left": 6, "right": 0, "diceCount": 1}, {"src": "dice_assets/dobbelsteen06b.png", "left": 1, "right": 5, "diceCount": 2}, {"src": "dice_assets/dobbelsteen06c.png", "left": 2, "right": 4, "diceCount": 2}, {"src": "dice_assets/dobbelsteen06d.png", "left": 3, "right": 3, "diceCount": 2}, {"src": "dice_assets/dobbelsteen06e.png", "left": 4, "right": 2, "diceCount": 2}, {"src": "dice_assets/dobbelsteen06f.png", "left": 5, "right": 1, "diceCount": 2}], "7": [{"src": "dice_assets/dobbelsteen07a.png", "left": 1, "right": 6, "diceCount": 2}, {"src": "dice_assets/dobbelsteen07b.png", "left": 2, "right": 5, "diceCount": 2}, {"src": "dice_assets/dobbelsteen07c.png", "left": 5, "right": 2, "diceCount": 2}, {"src": "dice_assets/dobbelsteen07d.png", "left": 6, "right": 1, "diceCount": 2}], "8": [{"src": "dice_assets/dobbelsteen08a.png", "left": 2, "right": 6, "diceCount": 2}, {"src": "dice_assets/dobbelsteen08b.png", "left": 4, "right": 4, "diceCount": 2}, {"src": "dice_assets/dobbelsteen08c.png", "left": 6, "right": 2, "diceCount": 2}], "9": [{"src": "dice_assets/dobbelsteen09a.png", "left": 4, "right": 5, "diceCount": 2}, {"src": "dice_assets/dobbelsteen09b.png", "left": 5, "right": 4, "diceCount": 2}], "10": [{"src": "dice_assets/dobbelsteen10.png", "left": 5, "right": 5, "diceCount": 2}]};

    const el = (id) => document.getElementById(id);

    const cardImg = el("cardImg");
    const cover = el("cover");
    const startBtn = el("startBtn");
    const pad = el("pad");

    const overlay = el("overlay");
    const emoji = el("emoji");
    const bigNumber = el("bigNumber");
    const nextBtn = el("nextBtn");

    const scorePill = el("scorePill");

    const gearBtn = el("gearBtn");
    const settingsMask = el("settingsMask");
    const warnBox = el("warnBox");

    const minTotalEl = el("minTotal");
    const maxTotalEl = el("maxTotal");
    const flashMsEl = el("flashMs");
    const step0El = el("step0");
    const step1El = el("step1");
    const step2El = el("step2");
    const bigFirstEl = el("bigFirst");
    const bigBackEl = el("bigBack");
    const saveBtn = el("saveBtn");
    const resetBtn = el("resetBtn");

    const STORAGE_KEY = "subiteer_dobbelspel_v2";

    const state = {
      settings: {
        minTotal: 1,
        maxTotal: 10,
        flashMs: 900,
        steps: [0,1,2],
        bigFirst: true,
        bigBack: true
      },
      score: 0,
      prevTotal: null,
      targetTotal: null,
      targetCard: null,
      phase: "idle",
      audio: null
    };

    function pick(arr){ return arr[Math.floor(Math.random() * arr.length)]; }
    function randInt(min, max){ return Math.floor(Math.random() * (max - min + 1)) + min; }
    function sleep(ms){ return new Promise(r => setTimeout(r, ms)); }

    function clampInt(v, min, max){
      const n = Number.parseInt(v, 10);
      if (Number.isNaN(n)) return min;
      return Math.max(min, Math.min(max, n));
    }

    function setWarn(msg){
      warnBox.textContent = msg;
      warnBox.style.display = "block";
    }
    function clearWarn(){ warnBox.style.display = "none"; }

    function loadSettings(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return;
        const data = JSON.parse(raw);
        if (!data || typeof data !== "object") return;

        const minTotal = clampInt(data.minTotal ?? 1, 1, 10);
        const maxTotal = clampInt(data.maxTotal ?? 10, 1, 10);
        const flashMs = clampInt(data.flashMs ?? 900, 200, 2500);
        const steps = Array.isArray(data.steps) ? data.steps.filter(x => [0,1,2].includes(x)) : [0,1,2];

        state.settings = {
          minTotal,
          maxTotal,
          flashMs,
          steps: steps.length ? steps : [0,1,2],
          bigFirst: !!data.bigFirst,
          bigBack: !!data.bigBack
        };
      } catch(e){}
    }

    function syncUIFromSettings(){
      minTotalEl.value = state.settings.minTotal;
      maxTotalEl.value = state.settings.maxTotal;
      flashMsEl.value = state.settings.flashMs;
      step0El.checked = state.settings.steps.includes(0);
      step1El.checked = state.settings.steps.includes(1);
      step2El.checked = state.settings.steps.includes(2);
      bigFirstEl.checked = state.settings.bigFirst;
      bigBackEl.checked = state.settings.bigBack;
    }

    function readSettingsFromUI(){
      const minTotal = clampInt(minTotalEl.value, 1, 10);
      const maxTotal = clampInt(maxTotalEl.value, 1, 10);
      const flashMs = clampInt(flashMsEl.value, 200, 2500);

      const steps = [];
      if (step0El.checked) steps.push(0);
      if (step1El.checked) steps.push(1);
      if (step2El.checked) steps.push(2);

      state.settings = {
        minTotal, maxTotal, flashMs,
        steps,
        bigFirst: !!bigFirstEl.checked,
        bigBack: !!bigBackEl.checked
      };
    }

    function validateSettings(){
      const s = state.settings;
      if (s.minTotal > s.maxTotal){ setWarn("min groter dan max"); return false; }
      if (!s.steps.length){ setWarn("kies stapjes"); return false; }
      clearWarn();
      return true;
    }

    function saveSettings(){
      readSettingsFromUI();
      if (!validateSettings()) return false;
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state.settings));
      return true;
    }

    function updateScoreUI(){
      scorePill.textContent = `‚≠ê ${state.score}`;
    }

    function openSettings(){
      syncUIFromSettings();
      settingsMask.classList.add("show");
    }
    function closeSettings(){
      settingsMask.classList.remove("show");
      clearWarn();
    }

    function ensureAudio(){
      if (state.audio) return;
      try{ state.audio = new (window.AudioContext || window.webkitAudioContext)(); }
      catch(e){ state.audio = null; }
    }
    function beep(ok){
      ensureAudio();
      const ctx = state.audio;
      if (!ctx) return;

      const o = ctx.createOscillator();
      const g = ctx.createGain();

      o.type = "sine";
      o.frequency.value = ok ? 740 : 240;

      g.gain.value = 0.0001;
      o.connect(g);
      g.connect(ctx.destination);

      const now = ctx.currentTime;
      g.gain.setValueAtTime(0.0001, now);
      g.gain.exponentialRampToValueAtTime(0.11, now + 0.02);
      g.gain.exponentialRampToValueAtTime(0.0001, now + 0.18);

      o.start(now);
      o.stop(now + 0.2);
    }

    function decideNextTotal(){
      const s = state.settings;

      if (state.prevTotal === null){
        return randInt(s.minTotal, s.maxTotal);
      }

      for (let i = 0; i < 30; i++){
        const step = pick(s.steps);
        const next = state.prevTotal + step;
        if (next >= s.minTotal && next <= s.maxTotal) return next;
      }

      const maxStep = Math.max(...s.steps);
      const upper = Math.max(s.minTotal, s.maxTotal - maxStep);
      const base = randInt(s.minTotal, upper);
      const step = pick(s.steps);
      return Math.min(s.maxTotal, base + step);
    }

    function pickCardForTotal(total){
      const s = state.settings;
      const options = (CARDS[String(total)] || []);
      if (!options.length) return null;

      const wantFirst = s.bigFirst;
      const wantBack = s.bigBack;

      let filtered = options;

      if (wantFirst !== wantBack){
        filtered = options.filter(o => {
          if (o.diceCount !== 2 || o.left === o.right) return true;
          if (wantFirst) return o.left > o.right;
          return o.right > o.left;
        });
        if (!filtered.length) filtered = options;
      }

      return pick(filtered);
    }

    function buildPad(){
      pad.innerHTML = "";
      const s = state.settings;

      for (let n = s.minTotal; n <= s.maxTotal; n++){
        const btn = document.createElement("button");
        btn.className = "numBtn";
        btn.textContent = n;
        btn.addEventListener("click", () => submitAnswer(n, btn));
        pad.appendChild(btn);
      }
    }

    function setCover(on, symbol){
      cover.textContent = symbol ?? " ";
      cover.classList.toggle("show", !!on);
    }

    function showOverlay(show){
      overlay.classList.toggle("show", !!show);
    }

    function lockPad(){
      pad.querySelectorAll("button").forEach(b => b.disabled = true);
    }

    async function startRound(){
      if (!validateSettings()) return;

      state.phase = "flashing";
      startBtn.style.display = "none";
      pad.style.display = "none";
      showOverlay(false);

      const total = decideNextTotal();
      state.targetTotal = total;
      state.targetCard = pickCardForTotal(total);

      if (state.targetCard){
        cardImg.src = state.targetCard.src;
      }

      setCover(true, " ");
      await sleep(140);

      setCover(false, " ");
      await sleep(state.settings.flashMs);

      setCover(true, "‚ùì");

      buildPad();
      pad.style.display = "grid";
      state.phase = "answering";
    }

    function submitAnswer(n, btn){
      if (state.phase !== "answering") return;
      state.phase = "result";
      lockPad();

      const ok = (n === state.targetTotal);
      btn.classList.add(ok ? "good" : "bad");

      if (ok){
        state.score += 1;
        emoji.textContent = "üòÑ";
        bigNumber.textContent = String(n);
        beep(true);
      } else {
        emoji.textContent = "üòï";
        bigNumber.textContent = String(state.targetTotal);
        beep(false);
      }

      state.prevTotal = state.targetTotal;
      updateScoreUI();
      showOverlay(true);
    }

    function nextRound(){
      showOverlay(false);
      startRound();
    }

    startBtn.addEventListener("click", startRound);
    nextBtn.addEventListener("click", nextRound);

    gearBtn.addEventListener("click", () => {
      if (settingsMask.classList.contains("show")) closeSettings();
      else openSettings();
    });

    settingsMask.addEventListener("click", (e) => {
      if (e.target === settingsMask) closeSettings();
    });

    saveBtn.addEventListener("click", () => {
      const ok = saveSettings();
      if (!ok) return;
      buildPad();
      closeSettings();
    });

    resetBtn.addEventListener("click", () => {
      state.score = 0;
      state.prevTotal = null;
      updateScoreUI();
      closeSettings();
      startBtn.style.display = "flex";
      pad.style.display = "none";
      setCover(true, "‚ñ∂");
      showOverlay(false);
      state.phase = "idle";
    });

    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closeSettings();
      if (e.key === " "){
        e.preventDefault();
        if (overlay.classList.contains("show")) nextRound();
        else if (state.phase === "idle") startRound();
      }
    });

    // Init
    loadSettings();
    syncUIFromSettings();
    validateSettings();
    updateScoreUI();

    cardImg.src = pickCardForTotal(6)?.src || (CARDS["6"]?.[0]?.src ?? "");
    setCover(true, "‚ñ∂");
  </script>
</body>
</html>
